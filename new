-- Sozdaem BD
CREATE DATABASE TK;
-- Sozdaem tablitsi v BD
CREATE TABLE SoldThings(                                  -- создаем таблицу SoldThings продаем вещи
	id INT NOT NULL PRIMARY KEY,                      -- первичный ключ, не может быть неопределим 
	dataSell date,                                    -- поле дата продажи
	HM_SellThings int, 			          -- количество проданного товара
	Cost1ye decimal(5,2),         			  -- стоимость за ед.товара
	idThing INT NOT NULL,
	FOREIGN KEY(idThing) REFERENCES Things(idThing),
	ON UPDATE CASCADE
);
CREATE SEQUANCE id.SoldThings minvalue 1 start with 1 cache 100; -- создаем последовательность на первичный ключ(инкрементация)

CREATE TABLE Sellers(					  -- создаем таблицу Sellers продавцы
	id INT NOT NULL PRIMARY KEY,	                  -- первичный ключ,не может быть неопределим 
	idSeller INT NOT NULL ,
	NameSeller varchar(30),				  -- Фамилия продавца
	FOREIGN KEY(idSeller) REFERENCES SoldThings(id),  -- внешний ключ SoldThings
        ON UPDATE CASCADE
);	
CREATE SEQUANCE id.Sellers minvalue 1 start with 1 cache 100; -- создаем последовательность на первичный ключ(инкрементация)


CREATE TABLE Things(					  -- создаем таблицу Вещи или товары
	idThing INT NOT NULL PRIMARY KEY,	          -- id товара, первичный ключ
	NameThing varchar(30),				  -- наименованеи товара
	idCateg INT NOT NULL, 				  -- id категория товара
	FOREIGN KEY(idCateg) REFERENCES Categories(idCateg),-- внешний ключ на таблицу категорий
        ON UPDATE CASCADE
);	
CREATE SEQUANCE idThing.Things minvalue 1 start with 1 cache 100; -- создаем последовательность на первичный ключ(инкрементация)

CREATE TABLE Categories(				  -- создаем таблицу категории
	idCateg INT NOT NULL PRIMARY KEY,                 -- первичный ключ таблицы
	NameCateg varchar(30),				  -- наименование категорий
	ON UPDATE CASCADE
);
CREATE SEQUANCE idCateg.Categories minvalue 1 start with 1 cache 100; -- создаем последовательность на первичный ключ(инкрементация)

INSERT INTO SoldThings(id, dataSell, HM_SellThings, Cost1ye) VALUE (1,'2020-11-22',2,300.00,1);
INSERT INTO Sellers(id,idSeller,NameSaller) VALUE (1,1,Petrov);
INSERT INTO Things(idThing,NameThing,idCateg) VALUE (1,'sausage',1);
INSERT INTO Categories(idCateg,NameCateg) VALUE (1,'Milk product');

SELECT NameCateg.Categories as Name, SUM(HM_SellThings.SoldThings) over(partitional by NameCateg.Categories) as QSold, 
SUM(Cost1ye.SoldThings) over(partionanal by NameCateg.Categories) as SumSold,
from SoldThings,Categories,Things
where
